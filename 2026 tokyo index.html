<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é—œæ±8æ—¥å¥³å­æ—… | å‰ä¼Šå¡å“‡é¢¨</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'chiika-pink': '#FFD1DC', // æ«»èŠ±ç²‰
                        'chiika-blue': '#A2D2FF', // å¯¶å¯¶è—
                        'chiika-yellow': '#FFF5BA', // å¥¶æ²¹é»ƒ
                        'chiika-bg': '#FFF5F7',   // æ¥µæ·¡ç²‰åº•
                        'chiika-text': '#5D5D5D', // æ·±ç°å­—
                    },
                    fontFamily: {
                        sans: ['Zen Maru Gothic', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #A2D2FF; 
            font-family: 'Zen Maru Gothic', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .banner-container {
            height: 250px;
            /* é è¨­åœ–ï¼Œè‹¥æ‚¨æœ‰ä¸Šå‚³ github è«‹æ”¹æˆæ‚¨çš„é€£çµ */
            background-image: url('https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?q=80&w=1920&auto=format&fit=crop'); 
            background-size: cover;
            background-position: left center;
            position: relative;
        }
        .app-content {
            background-color: #FFF5F7;
            border-top-left-radius: 30px;
            border-top-right-radius: 30px;
            margin-top: -30px; 
            position: relative;
            z-index: 10;
            min-height: calc(100vh - 220px);
            padding-bottom: 100px; /* å¢åŠ åº•éƒ¨ç©ºé–“çµ¦ Tab */
        }
        /* æ¼‚æµ®çš„ Tabs */
        .floating-tabs {
            position: fixed;
            bottom: 20px; 
            left: 50%;
            transform: translateX(-50%);
            z-index: 40;
            display: flex;
            gap: 12px;
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 15px;
            border-radius: 50px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            backdrop-filter: blur(5px);
        }
        .tab-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            color: #9CA3AF;
            transition: all 0.2s;
            position: relative;
        }
        .tab-btn.active {
            background: #FFD1DC;
            color: white;
            transform: translateY(-5px);
            box-shadow: 0 4px 10px rgba(255, 209, 220, 0.6);
        }
        .tab-label {
            position: absolute;
            bottom: -20px;
            font-size: 10px;
            width: max-content;
            color: #888;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .tab-btn.active .tab-label {
            opacity: 1;
            color: #FF8FAB;
            font-weight: bold;
        }
        /* å¡ç‰‡æ¨£å¼ */
        .card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 10px rgba(255, 183, 178, 0.2);
            transition: transform 0.1s;
        }
        .card:active {
            transform: scale(0.99);
        }
        /* ç­†è¨˜æœ¬é¢¨æ ¼ Checkbox */
        .notepad-item {
            border-bottom: 1px dashed #cbd5e1;
            padding: 12px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .notepad-checkbox {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid #FFD1DC;
            border-radius: 6px;
            position: relative;
            cursor: pointer;
        }
        .notepad-checkbox:checked {
            background-color: #FFD1DC;
        }
        .notepad-checkbox:checked::after {
            content: 'âœ”';
            color: white;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
        }
        .strikethrough {
            text-decoration: line-through;
            color: #cbd5e1;
        }
    </style>
</head>
<body>

<div id="app" class="max-w-md mx-auto relative min-h-screen bg-blue-200">

    <div class="banner-container relative">
        <div class="absolute bottom-10 left-4 text-white drop-shadow-md">
            <h1 class="text-2xl font-bold">é—œæ±8æ—¥å¥³å­æ—… ğŸŒ¸</h1>
            <p class="text-sm opacity-90">å¯Œå£«å±±è‡ªé§• x å‰ä¼Šå¡å“‡</p>
        </div>
    </div>

    <div class="app-content px-4 py-6">

        <div v-if="currentTab === 'itinerary'">
            
            <div class="flex overflow-x-auto hide-scrollbar gap-3 mb-6 pb-2">
                <div v-for="(day, index) in tripDays" :key="index" 
                     @click="selectedDayIndex = index"
                     :class="['flex-shrink-0 w-16 h-20 rounded-2xl flex flex-col items-center justify-center cursor-pointer transition-all', 
                              selectedDayIndex === index ? 'bg-chiika-pink text-white shadow-md' : 'bg-white text-gray-400']">
                    <span class="text-xs font-bold">{{ day.week }}</span>
                    <span class="text-2xl font-bold">{{ day.dateNum }}</span>
                </div>
            </div>

            <div class="rounded-2xl p-4 mb-6 flex items-center justify-between shadow-sm text-white" 
                 style="background: linear-gradient(to right, #ffecd2 0%, #fcb69f 100%);">
                <div class="flex items-center gap-3">
                    <i class="fa-solid fa-sun text-3xl text-yellow-100"></i>
                    <div>
                        <div class="text-lg font-bold">å¯Œå£«å±±</div>
                        <div class="text-xs opacity-90">æ™´æ™‚å¤šé›²</div>
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-3xl font-bold">12Â°C</div>
                    <div class="text-xs opacity-80">é«”æ„Ÿ 10Â°C</div>
                </div>
            </div>

            <div class="space-y-0 pb-20">
                <div v-for="(item, idx) in currentDayItinerary" :key="item.id" class="relative">
                    
                    <div v-if="idx > 0" class="ml-5 border-l-2 border-dashed border-gray-300 h-10 flex items-center pl-6 text-xs text-gray-400">
                        <i :class="getTransportIcon(item.transportType)" class="mr-2"></i>
                        <span>ç´„ {{ item.travelTime }} åˆ†é˜</span>
                    </div>
                    <div v-else-if="selectedDayIndex > 0" class="ml-5 border-l-2 border-dashed border-gray-300 h-8 flex items-center pl-6 text-xs text-gray-400 pb-2">
                         <i class="fa-solid fa-bed mr-2"></i> å¾æ˜¨æ™šä½å®¿å‡ºç™¼
                    </div>

                    <div @click="openMap(item.name)" 
                         :class="['card p-4 flex gap-4 cursor-pointer relative group', item.category === 'Flight' ? 'bg-gradient-to-r from-blue-100 to-purple-100' : 'bg-white']">
                        
                        <div class="w-12 h-12 rounded-full bg-blue-50 flex items-center justify-center flex-shrink-0 text-chiika-blue text-xl">
                            <i :class="getCategoryIcon(item.category)"></i>
                        </div>

                        <div class="flex-1">
                            <div class="flex justify-between items-start">
                                <h3 class="font-bold text-lg leading-tight">{{ item.name }}</h3>
                                <button @click.stop="deleteItem(idx)" class="text-gray-300 hover:text-red-400 p-1">
                                    <i class="fa-solid fa-trash-can text-xs"></i>
                                </button>
                            </div>
                            
                            <div v-if="item.hours" class="text-xs mt-1 opacity-80">
                                <i class="fa-regular fa-clock mr-1"></i> {{ item.hours }}
                            </div>
                            <div v-if="item.ticket" class="text-xs mt-1 text-pink-500 font-bold">
                                <i class="fa-solid fa-ticket mr-1"></i> {{ item.ticket }}
                            </div>
                            <p class="text-xs mt-2 opacity-70 leading-relaxed">{{ item.note }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <button @click="showAddModal = true" class="fixed bottom-24 right-6 w-14 h-14 bg-chiika-blue text-white rounded-full shadow-lg flex items-center justify-center text-2xl z-30 hover:bg-blue-300 transition-colors">
                <i class="fa-solid fa-plus"></i>
            </button>
        </div>


        <div v-if="currentTab === 'prep'" class="pb-24">
            <h2 class="text-xl font-bold text-chiika-text mb-4 pl-2 border-l-4 border-pink-300">è¡Œå‰æº–å‚™æ¸…å–®</h2>

            <a href="https://vjw-lp.digital.go.jp/zh-hant/" target="_blank" 
               class="block w-full bg-gradient-to-r from-pink-400 to-red-400 text-white p-4 rounded-xl shadow-lg mb-6 flex items-center justify-between hover:opacity-90 transition">
                <div class="flex items-center gap-3">
                    <i class="fa-solid fa-qrcode text-2xl"></i>

                    <div>
                        <div class="font-bold text-lg">Visit Japan Web</div>
                        <div class="text-xs opacity-90">å…¥å¢ƒæ—¥æœ¬å¿…å¡«ï¼ŒæŒ‰æ­¤å‰å¾€</div>
                    </div>
                </div>
                <i class="fa-solid fa-chevron-right"></i>
            </a>

            <div class="bg-white rounded-2xl shadow-sm p-6 relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-4 bg-chiika-yellow opacity-50"></div>
                
                <div v-for="(item, idx) in prepList" :key="idx" class="notepad-item">
                    <input type="checkbox" v-model="item.checked" class="notepad-checkbox">
                    <span :class="['flex-1 text-sm font-medium', item.checked ? 'strikethrough' : 'text-gray-700']">{{ item.text }}</span>
                    <button @click="removePrepItem(idx)" class="text-gray-300 hover:text-red-400"><i class="fa-solid fa-xmark"></i></button>
                </div>

                <div class="mt-4 flex gap-2">
                    <input v-model="newPrepInput" @keyup.enter="addPrepItem" placeholder="æ–°å¢æº–å‚™é …ç›®..." class="flex-1 bg-gray-50 border-b-2 border-gray-200 p-2 text-sm outline-none focus:border-chiika-pink">
                    <button @click="addPrepItem" class="text-chiika-pink font-bold text-sm">æ–°å¢</button>
                </div>
            </div>
        </div>


        <div v-if="currentTab === 'shopping'" class="pb-24">
            <h2 class="text-xl font-bold text-chiika-text mb-4 pl-2 border-l-4 border-blue-300">è³¼ç‰©é¡˜æœ›æ¸…å–®</h2>
            
            <div class="grid grid-cols-2 gap-3">
                <div v-for="(item, idx) in shoppingList" :key="idx" class="card p-3 flex flex-col items-center relative group">
                    <button @click="shoppingList.splice(idx, 1)" class="absolute top-2 right-2 w-6 h-6 bg-white rounded-full text-red-400 shadow flex items-center justify-center z-10">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                    <div class="w-full h-32 bg-gray-100 rounded-lg mb-2 overflow-hidden flex items-center justify-center">
                        <img v-if="item.image" :src="item.image" class="w-full h-full object-cover">
                        <i v-else class="fa-regular fa-image text-gray-300 text-3xl"></i>
                    </div>
                    <div class="font-bold text-sm text-center w-full truncate">{{ item.name }}</div>
                </div>

                <div @click="showShopModal = true" class="card p-3 flex flex-col items-center justify-center min-h-[160px] cursor-pointer border-2 border-dashed border-gray-300 hover:border-pink-300 bg-transparent shadow-none">
                    <i class="fa-solid fa-plus text-3xl text-gray-300"></i>
                    <div class="text-xs text-gray-400 mt-2">æ–°å¢å•†å“</div>
                </div>
            </div>
        </div>


        <div v-if="currentTab === 'expenses'" class="pb-24">
            
            <div class="flex bg-white rounded-full p-1 mb-6 shadow-sm">
                <button @click="expenseMode = 'personal'" :class="['flex-1 py-2 rounded-full text-sm font-bold transition', expenseMode === 'personal' ? 'bg-chiika-yellow text-gray-700 shadow-sm' : 'text-gray-400']">
                    å€‹äººè¨˜å¸³
                </button>
                <button @click="expenseMode = 'split'" :class="['flex-1 py-2 rounded-full text-sm font-bold transition', expenseMode === 'split' ? 'bg-chiika-pink text-white shadow-sm' : 'text-gray-400']">
                    åˆ†å¸³è¡¨
                </button>
            </div>

            <div v-if="expenseMode === 'personal'">
                <div class="bg-chiika-yellow text-gray-700 p-6 rounded-2xl mb-4 text-center shadow-lg relative overflow-hidden">
                    <i class="fa-solid fa-coins absolute -bottom-4 -right-4 text-6xl text-yellow-200 opacity-50"></i>
                    <div class="text-sm opacity-80">å€‹äººç¸½èŠ±è²» (JPY)</div>
                    <div class="text-4xl font-bold mt-1">Â¥ {{ totalExpenses.toLocaleString() }}</div>
                </div>
                <div class="space-y-3">
                    <div v-for="(exp, idx) in expenses" :key="idx" class="card p-3 flex justify-between items-center relative">
                        <button @click="expenses.splice(idx, 1)" class="absolute -left-2 -top-2 w-5 h-5 bg-red-400 text-white rounded-full text-xs hidden group-hover:flex items-center justify-center">x</button>
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-500">
                                <i :class="getCategoryIcon(exp.category)"></i>
                            </div>
                            <div>
                                <div class="font-bold text-sm">{{ exp.name }}</div>
                                <div class="text-xs text-gray-400">{{ exp.date }} Â· {{ exp.payment }}</div>
                            </div>
                        </div>
                        <div class="font-bold text-gray-700">Â¥{{ parseInt(exp.amount).toLocaleString() }}</div>
                    </div>
                </div>
                <button @click="showExpenseModal = true" class="fixed bottom-24 right-6 w-14 h-14 bg-yellow-400 text-white rounded-full shadow-lg flex items-center justify-center text-2xl z-30">
                    <i class="fa-solid fa-plus"></i>
                </button>
            </div>

            <div v-if="expenseMode === 'split'">
                <div class="mb-4">
                    <div class="text-xs text-gray-500 mb-2 font-bold ml-1">åˆ†å¸³æˆå“¡</div>
                    <div class="flex flex-wrap gap-2">
                        <div v-for="(member, idx) in splitMembers" :key="idx" class="bg-white px-3 py-1 rounded-full text-sm shadow-sm flex items-center gap-2 border border-pink-100">
                            <span class="text-gray-600">{{ member }}</span>
                            <button @click="removeMember(idx)" class="text-gray-300 hover:text-red-400 text-xs"><i class="fa-solid fa-xmark"></i></button>
                        </div>
                        <button @click="addMember" class="px-3 py-1 rounded-full text-sm bg-gray-200 text-gray-500 hover:bg-gray-300 transition">+ åŠ äºº</button>
                    </div>
                </div>

                <h3 class="font-bold text-chiika-text mb-3 pl-2 border-l-4 border-pink-300">å…¬æ¬¾æ”¯å‡ºè¨˜éŒ„</h3>
                <div class="space-y-3">
                    <div v-for="(bill, idx) in splitBills" :key="idx" class="card p-4">
                        <div class="flex justify-between items-start mb-2">
                            <div class="font-bold text-lg text-gray-700">{{ bill.item }}</div>
                            <div class="font-bold text-pink-500">Â¥{{ parseInt(bill.amount).toLocaleString() }}</div>
                        </div>
                        <div class="flex justify-between items-center text-xs text-gray-500 bg-gray-50 p-2 rounded-lg">
                            <div><span class="bg-blue-100 text-blue-600 px-2 py-0.5 rounded mr-1">ä»˜æ¬¾äºº</span> {{ bill.payer }}</div>
                            <button @click="splitBills.splice(idx, 1)" class="text-red-300 hover:text-red-500"><i class="fa-solid fa-trash-can"></i></button>
                        </div>
                    </div>
                    <div v-if="splitBills.length === 0" class="text-center text-gray-400 text-sm py-8">
                        ç›®å‰æ²’æœ‰åˆ†å¸³è¨˜éŒ„<br>é»æ“Šå³ä¸‹è§’æ–°å¢
                    </div>
                </div>

                <button @click="showSplitModal = true" class="fixed bottom-24 right-6 w-14 h-14 bg-chiika-pink text-white rounded-full shadow-lg flex items-center justify-center text-2xl z-30">
                    <i class="fa-solid fa-hand-holding-dollar"></i>
                </button>
            </div>
        </div>


        <div v-if="currentTab === 'info'" class="pb-24">
            <h2 class="text-xl font-bold text-chiika-text mb-4 pl-2 border-l-4 border-gray-300">æ—…è¡Œè³‡è¨Š</h2>
            
            <div class="card p-5 mb-4">
                <h3 class="font-bold text-chiika-text mb-3"><i class="fa-solid fa-calculator text-gray-400 mr-2"></i>åŒ¯ç‡è©¦ç®—</h3>
                <div class="flex gap-2 items-center">
                    <input type="number" v-model="currencyInput" placeholder="æ—¥å¹£" class="w-full bg-gray-50 rounded-lg p-2 border border-gray-200 outline-none focus:border-chiika-blue">
                    <i class="fa-solid fa-arrow-right text-gray-400"></i>
                    <div class="w-full bg-gray-100 rounded-lg p-2 text-gray-700 font-bold">
                        NT$ {{ (currencyInput * 0.215).toFixed(0) }}
                    </div>
                </div>
            </div>

            <div class="card p-4">
                <h3 class="font-bold text-chiika-text mb-3">ä½å®¿è³‡è¨Š</h3>
                <ul class="space-y-3 text-sm">
                    <li class="flex gap-3">
                        <i class="fa-solid fa-hotel text-pink-400 mt-1"></i>
                        <div>
                            <div class="font-bold">éŒ¦ç³»ç”º Sumida City</div>
                            <div class="text-xs text-gray-500">ç¬¬ 1-2 æ™š</div>
                        </div>
                    </li>
                    <li class="flex gap-3">
                        <i class="fa-solid fa-hotel text-pink-400 mt-1"></i>
                        <div>
                            <div class="font-bold">Megu Fuji 2021</div>
                            <div class="text-xs text-gray-500">ç¬¬ 3-4 æ™š</div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>

    </div>

    <div class="floating-tabs">
        <button @click="currentTab = 'itinerary'" :class="['tab-btn', currentTab === 'itinerary' ? 'active' : '']">
            <i class="fa-solid fa-map-location-dot"></i>
            <span class="tab-label">è¡Œç¨‹</span>
        </button>
        <button @click="currentTab = 'prep'" :class="['tab-btn', currentTab === 'prep' ? 'active' : '']">
            <i class="fa-solid fa-suitcase-rolling"></i>
            <span class="tab-label">è¡Œå‰</span>
        </button>
        <button @click="currentTab = 'shopping'" :class="['tab-btn', currentTab === 'shopping' ? 'active' : '']">
            <i class="fa-solid fa-basket-shopping"></i>
            <span class="tab-label">è³¼ç‰©</span>
        </button>
        <button @click="currentTab = 'expenses'" :class="['tab-btn', currentTab === 'expenses' ? 'active' : '']">
            <i class="fa-solid fa-sack-dollar"></i>
            <span class="tab-label">èŠ±è²»</span>
        </button>
        <button @click="currentTab = 'info'" :class="['tab-btn', currentTab === 'info' ? 'active' : '']">
            <i class="fa-solid fa-circle-info"></i>
            <span class="tab-label">è³‡è¨Š</span>
        </button>
    </div>

    <div v-if="showAddModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-2xl p-5 shadow-2xl">
            <h3 class="font-bold text-xl mb-4 text-center">æ–°å¢è¡Œç¨‹</h3>
            <div class="space-y-3">
                <input v-model="newItem.name" placeholder="åç¨±" class="w-full p-2 border rounded-lg bg-gray-50">
                <select v-model="newItem.category" class="w-full p-2 border rounded-lg bg-gray-50">
                    <option value="Sightseeing">æ™¯é»</option>
                    <option value="Food">ç¾é£Ÿ</option>
                    <option value="Shopping">è³¼ç‰©</option>
                    <option value="Other">å…¶ä»–</option>
                </select>
                <div class="flex gap-2">
                    <button @click="showAddModal = false" class="flex-1 py-2 bg-gray-200 rounded-lg">å–æ¶ˆ</button>
                    <button @click="addItem" class="flex-1 py-2 bg-chiika-blue text-white rounded-lg">æ–°å¢</button>
                </div>
            </div>
        </div>
    </div>

    <div v-if="showShopModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-2xl p-5">
            <h3 class="font-bold text-xl mb-4 text-center">åŠ å…¥è³¼ç‰©è»Š</h3>
            <input v-model="newShopItem.name" placeholder="å•†å“åç¨±" class="w-full p-2 border rounded-lg mb-3">
            <label class="block w-full p-3 border-2 border-dashed border-gray-300 rounded-lg text-center text-gray-400 cursor-pointer hover:bg-gray-50">
                <i class="fa-solid fa-camera mb-1"></i><br>ä¸Šå‚³åœ–ç‰‡
                <input type="file" @change="handleImageUpload" class="hidden">
            </label>
            <div v-if="newShopItem.image" class="mt-2 text-center text-xs text-green-500">å·²é¸æ“‡åœ–ç‰‡</div>
            <div class="flex gap-2 mt-4">
                <button @click="showShopModal = false" class="flex-1 py-2 bg-gray-200 rounded-lg">å–æ¶ˆ</button>
                <button @click="addShopItem" class="flex-1 py-2 bg-pink-400 text-white rounded-lg">ç¢ºå®š</button>
            </div>
        </div>
    </div>

     <div v-if="showExpenseModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-2xl p-5">
            <h3 class="font-bold text-xl mb-4 text-center">å€‹äººè¨˜å¸³</h3>
            <div class="space-y-3">
                <input v-model="newExpense.name" placeholder="é …ç›®åç¨±" class="w-full p-2 border rounded-lg">
                <input type="number" v-model="newExpense.amount" placeholder="é‡‘é¡ (JPY)" class="w-full p-2 border rounded-lg">
                <select v-model="newExpense.category" class="w-full p-2 border rounded-lg">
                    <option value="Food">é£²é£Ÿ</option>
                    <option value="Transport">äº¤é€š</option>
                    <option value="Shopping">è³¼ç‰©</option>
                    <option value="Other">å…¶ä»–</option>
                </select>
                <div class="flex gap-2 pt-2">
                    <button @click="showExpenseModal = false" class="flex-1 py-2 bg-gray-200 rounded-lg">å–æ¶ˆ</button>
                    <button @click="addExpense" class="flex-1 py-2 bg-yellow-400 text-white rounded-lg">å„²å­˜</button>
                </div>
            </div>
        </div>
    </div>

    <div v-if="showSplitModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-2xl p-5 border-4 border-chiika-pink">
            <h3 class="font-bold text-xl mb-4 text-center text-chiika-text">æ–°å¢å…¬æ¬¾æ”¯å‡º</h3>
            <div class="space-y-3">
                <div class="text-xs text-gray-400">èª°å…ˆå¢ŠéŒ¢ï¼Ÿ</div>
                <div class="flex gap-2 overflow-x-auto pb-2">
                    <button v-for="m in splitMembers" :key="m" 
                        @click="newSplit.payer = m"
                        :class="['px-3 py-1 rounded-full text-sm border whitespace-nowrap', newSplit.payer === m ? 'bg-chiika-pink text-white border-chiika-pink' : 'border-gray-300 text-gray-500']">
                        {{ m }}
                    </button>
                </div>

                <input v-model="newSplit.item" placeholder="é …ç›® (ä¾‹: ç§Ÿè»Šè²»)" class="w-full p-2 border rounded-lg">
                <input type="number" v-model="newSplit.amount" placeholder="ç¸½é‡‘é¡ (JPY)" class="w-full p-2 border rounded-lg">
                
                <div class="flex gap-2 pt-2">
                    <button @click="showSplitModal = false" class="flex-1 py-2 bg-gray-200 rounded-lg">å–æ¶ˆ</button>
                    <button @click="addSplitBill" class="flex-1 py-2 bg-chiika-pink text-white rounded-lg">æ–°å¢è¨˜éŒ„</button>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
    const { createApp, ref, computed } = Vue;

    createApp({
        setup() {
            const currentTab = ref('itinerary');
            const selectedDayIndex = ref(0);
            const currencyInput = ref('');
            
            // Modals & Mode
            const showAddModal = ref(false);
            const showShopModal = ref(false);
            const showExpenseModal = ref(false);
            const showSplitModal = ref(false);
            const expenseMode = ref('personal'); // personal | split

            // Data
            const tripDays = [
                { date: '2026-03-27', week: 'Fri', dateNum: '27' },
                { date: '2026-03-28', week: 'Sat', dateNum: '28' },
                { date: '2026-03-29', week: 'Sun', dateNum: '29' },
                { date: '2026-03-30', week: 'Mon', dateNum: '30' },
                { date: '2026-03-31', week: 'Tue', dateNum: '31' },
                { date: '2026-04-01', week: 'Wed', dateNum: '01' },
                { date: '2026-04-02', week: 'Thu', dateNum: '02' },
                { date: '2026-04-03', week: 'Fri', dateNum: '03' }
            ];

            const itineraryData = ref([
                [{ id: 1, category: 'Flight', name: 'é…·èˆª TR898 èµ·é£›', hours: '06:40', note: 'æ¡ƒåœ’ç¬¬ä¸€èˆªå»ˆ', travelTime: 0, transportType: 'flight' }],
                [], [], [], [], [], [], [] // Placeholder for other days
            ]);

            // Shopping List
            const shoppingList = ref([
                { name: 'å‰ä¼Šå¡å“‡ç©å¶', image: '' },
                { name: 'è—¥å¦åº—é¢è†œ', image: '' }
            ]);

            // Prep List (è¡Œå‰)
            const prepList = ref([
                { text: 'è­·ç…§ (æ•ˆæœŸ6å€‹æœˆä»¥ä¸Š)', checked: false },
                { text: 'Visit Japan Web æˆªåœ–', checked: false },
                { text: 'æ—¥å¹£ç¾é‡‘', checked: false },
                { text: 'ä¿¡ç”¨å¡ (æµ·å¤–å›é¥‹é«˜)', checked: false },
                { text: 'ç¶²å¡ / æ¼«éŠé–‹é€š', checked: false },
                { text: 'é§•ç…§ + æ—¥æ–‡è­¯æœ¬ (è‡ªé§•ç”¨)', checked: false }
            ]);
            const newPrepInput = ref('');

            // Expenses - Personal
            const expenses = ref([
                { category: 'Transport', name: 'è¥¿ç“œå¡å„²å€¼', date: '03/27', amount: 5000, payment: 'ç¾é‡‘' }
            ]);

            // Expenses - Split Bill
            const splitMembers = ref(['æˆ‘', 'å°å…«', 'å…”å…”']);
            const splitBills = ref([]); // { item: '', amount: 0, payer: '' }
            const newSplit = ref({ item: '', amount: '', payer: 'æˆ‘' });

            // Temp Models
            const newItem = ref({ name: '', category: 'Sightseeing', hours: '', ticket: '', note: '', travelTime: 15, transportType: 'walk' });
            const newShopItem = ref({ name: '', image: null });
            const newExpense = ref({ category: 'Food', name: '', amount: '', payment: 'ç¾é‡‘', date: '' });

            // Computeds
            const currentDayItinerary = computed(() => itineraryData.value[selectedDayIndex.value] || []);
            const totalExpenses = computed(() => expenses.value.reduce((sum, item) => sum + Number(item.amount), 0));

            // Methods
            const getCategoryIcon = (cat) => {
                const map = { 'Sightseeing': 'fa-camera', 'Food': 'fa-utensils', 'Shopping': 'fa-bag-shopping', 'Flight': 'fa-plane', 'Transport': 'fa-train-subway', 'Hotel': 'fa-hotel', 'Other': 'fa-star' };
                return map[cat] || 'fa-star';
            };
            const getTransportIcon = (type) => {
                const map = { 'walk': 'fa-person-walking', 'car': 'fa-car', 'train': 'fa-train-subway', 'bike': 'fa-bicycle', 'flight': 'fa-plane' };
                return map[type] || 'fa-person-walking';
            };
            const openMap = (keyword) => window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(keyword)}`, '_blank');
            
            // Shopping Methods
            const handleImageUpload = (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => newShopItem.value.image = e.target.result;
                    reader.readAsDataURL(file);
                }
            };
            const addShopItem = () => {
                if(!newShopItem.value.name) return;
                shoppingList.value.push({ ...newShopItem.value });
                showShopModal.value = false;
                newShopItem.value = { name: '', image: null };
            };

            // Itinerary Methods
            const addItem = () => {
                if(!newItem.value.name) return;
                const list = itineraryData.value[selectedDayIndex.value];
                list.push({ ...newItem.value, id: Date.now() });
                showAddModal.value = false;
                newItem.value = { name: '', category: 'Sightseeing', hours: '', ticket: '', note: '', travelTime: 15, transportType: 'walk' };
            };
            const deleteItem = (idx) => {
                if(confirm('åˆªé™¤æ­¤è¡Œç¨‹ï¼Ÿ')) itineraryData.value[selectedDayIndex.value].splice(idx, 1);
            };

            // Prep Methods
            const addPrepItem = () => {
                if(!newPrepInput.value) return;
                prepList.value.push({ text: newPrepInput.value, checked: false });
                newPrepInput.value = '';
            };
            const removePrepItem = (idx) => prepList.value.splice(idx, 1);

            // Expense Methods
            const addExpense = () => {
                if(!newExpense.value.amount) return;
                const today = new Date();
                const dateStr = `${(today.getMonth()+1).toString().padStart(2, '0')}/${today.getDate().toString().padStart(2, '0')}`;
                expenses.value.push({ ...newExpense.value, date: dateStr });
                showExpenseModal.value = false;
                newExpense.value = { category: 'Food', name: '', amount: '', payment: 'ç¾é‡‘', date: '' };
            };

            // Split Bill Methods
            const addMember = () => {
                const name = prompt('è«‹è¼¸å…¥æˆå“¡åç¨±ï¼š');
                if(name) splitMembers.value.push(name);
            };
            const removeMember = (idx) => {
                if(confirm(`ç§»é™¤æˆå“¡ ${splitMembers.value[idx]}ï¼Ÿ`)) splitMembers.value.splice(idx, 1);
            };
            const addSplitBill = () => {
                if(!newSplit.value.amount || !newSplit.value.item) return;
                splitBills.value.push({ ...newSplit.value });
                showSplitModal.value = false;
                newSplit.value = { item: '', amount: '', payer: splitMembers.value[0] || 'æˆ‘' };
            };

            return {
                currentTab, selectedDayIndex, tripDays, currentDayItinerary, 
                getCategoryIcon, getTransportIcon, openMap, currencyInput,
                showAddModal, newItem, addItem, deleteItem,
                shoppingList, showShopModal, newShopItem, handleImageUpload, addShopItem,
                expenses, totalExpenses, showExpenseModal, newExpense, addExpense, expenseMode,
                prepList, newPrepInput, addPrepItem, removePrepItem,
                splitMembers, splitBills, showSplitModal, newSplit, addMember, removeMember, addSplitBill
            };
        }
    }).mount('#app');
</script>

</body>
</html>
